#ç«¯å£æ˜ å°„
mixed-port: 7890
redir-port: 7891
tproxy-port: 1536
ipv6: true
mode: Rule
allow-lan: true
disable-keep-alive: true
experimental:
  http-headers:
    request:
      - name: "User-Agent"
        value: "Mozilla/5.0 (Linux; Android 10; K) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Mobile Safari/537.36"
      - name: "Accept-Language"
        value: "en-US,en;q=0.9"
unified-delay: true
tcp-concurrent: true
log-level: silent
find-process-mode: always
global-client-fingerprint: firefox
external-controller: 0.0.0.0:9090
external-ui: "./Web/Zash"
profile:
  store-selected: true
  store-fake-ip: true
  smart-collector-size: 1024

#åŸŸåå—…æ¢æ¨¡å—

sniffer:
  enable: true
  force-dns-mapping: true
  parse-pure-ip: true
  override-destination: true
  sniff:
    HTTP:
      ports: [80, 443, 8080-8880]
    TLS:
      ports: [443, 5228, 8443]
    QUIC:
      ports: [443, 853, 784, 8443]
  force-domain:
    - "+.v2ex.com"
  skip-domain: # å¦‚é‡éœ€å†…éƒ¨é€šä¿¡çš„åº”ç”¨è¯·æ”¾è¡Œè¯¥åŸŸå
    - "Mijia Cloud"

tun:
  enable: true
  device: kers
  stack: mixed
  dns-hijack:
    - any:53
    - tcp://any:53
  udp-timeout: 300
  auto-route: true
  strict-route: true
  auto-redirect: false
  auto-detect-interface: true
  exclude-uid: [1000, 1001, 10116, 10117, 10125, 10177, 10206, 10249, 10312, 10388, 10417, 15001000, 15001001, 15010117, 15010206, 15010249, 15010388, 15010417]


dns:
  enable: true
  prefer-h3: true
  ipv6: true
  listen: 0.0.0.0:1053
  enhanced-mode: fake-ip
#  fake-ip-filter-mode: whitelist
  fake-ip-range: 172.20.0.1/16
  fake-ip-filter:
    - "RULE-SET:private_åŸŸ"
    - "RULE-SET:GoogleFCM_åŸŸ"
    - "RULE-SET:CN_åŸŸ"
    - "RULE-SET:FS"
    - "RULE-SET:YM"
#ä½¿ç”¨ä¸ªäººè‡ªå»ºç§äºº è¿›è¡Œå¹¿å‘Šè¿‡æ»¤å’Œé˜²è¿½è¸ª
  default-nameserver:
    - quic://94.140.14.14
    - quic://223.5.5.5:853
  nameserver:
    - quic://dns1.killove.cn:784
    - quic://dns2.killove.cn:784
    - quic://dns3.killove.cn:784
    - quic://dns4.killove.cn:784
    - quic://dns5.killove.cn:784
    - quic://dns6.killove.cn:784
# é”šç‚¹ - èŠ‚ç‚¹ç±»å‹ç­›é€‰

#Dedicated/é«˜é€Ÿ
Dedicated: &Dedicated "^(?=.*(ä¸“çº¿|IPLC|IEPL|é«˜é€Ÿ|ä¸‰ç½‘|ç”µä¿¡|ç§»åŠ¨|è”é€š))(?!.*(CN|Private|ä¸­è½¬|ä¼˜åŒ–|å®¶å®½|åŸç”Ÿ|è½åœ°|æ–°åè®®)).*$"

#Transit/ä¼˜åŒ–
Transit: &Transit "^(?=.*(ä¸­è½¬|ä¼˜åŒ–|å®¶å®½|åŸç”Ÿ|è½åœ°|æ–°åè®®))(?!.*(CN|Private|Dedicated|IPLC|IEPL|é«˜é€Ÿ|ä¸‰ç½‘|ç”µä¿¡|ç§»åŠ¨|è”é€š)).*$"

# ADHOME
Kers: &Kers "^(?=.*(Private)).*$"

#æŠ“å–èŠ‚ç‚¹
#cloudflare: &cloudflare "^(?=.*(cloudflare)).*$"
# é¦™æ¸¯
Hong: &Hong "^(?=.*(ğŸ‡­ğŸ‡°|HK|Hong Kong|é¦™æ¸¯))(?!.*(ä¸“çº¿|IPLC|IEPL|é«˜é€Ÿ|ä¸‰ç½‘|ç”µä¿¡|ç§»åŠ¨|è”é€š|ä¸­è½¬|ä¼˜åŒ–|å®¶å®½|åŸç”Ÿ|è½åœ°|æ–°åè®®|Private|cloudflare|CN|cn)).*$"

# æ—¥æœ¬
Japan: &Japan "^(?=.*(ğŸ‡¯ğŸ‡µ|JP|Japan|æ—¥æœ¬))(?!.*(ä¸“çº¿|IPLC|IEPL|é«˜é€Ÿ|ä¸‰ç½‘|ç”µä¿¡|ç§»åŠ¨|è”é€š|ä¸­è½¬|ä¼˜åŒ–|å®¶å®½|åŸç”Ÿ|è½åœ°|æ–°åè®®|Private|cloudflare|CN|cn)).*$"

# ç¾å›½
United: &United "^(?=.*(ğŸ‡ºğŸ‡¸|US|United States|ç¾å›½))(?!.*(ä¸“çº¿|IPLC|IEPL|é«˜é€Ÿ|ä¸‰ç½‘|ç”µä¿¡|ç§»åŠ¨|è”é€š|ä¸­è½¬|ä¼˜åŒ–|å®¶å®½|åŸç”Ÿ|è½åœ°|æ–°åè®®|Private|cloudflare|CN|cn)).*$"

# å°æ¹¾
Taiwan: &Taiwan "^(?=.*(ğŸ‡¨ğŸ‡³|TW|Taiwan|å°|æ–°åŒ—|å½°åŒ–))(?!.*(ä¸“çº¿|IPLC|IEPL|é«˜é€Ÿ|ä¸‰ç½‘|ç”µä¿¡|ç§»åŠ¨|è”é€š|ä¸­è½¬|ä¼˜åŒ–|å®¶å®½|åŸç”Ÿ|è½åœ°|æ–°åè®®|Private|cloudflare|CN|cn)).*$"

#æ–°åŠ å¡
Lion: &Lion "^(?=.*(ğŸ‡¸ğŸ‡¬|SG|Singapore|æ–°åŠ å¡|ç‹®åŸ))(?!.*(ä¸“çº¿|IPLC|IEPL|é«˜é€Ÿ|ä¸‰ç½‘|ç”µä¿¡|ç§»åŠ¨|è”é€š|ä¸­è½¬|ä¼˜åŒ–|å®¶å®½|åŸç”Ÿ|è½åœ°|æ–°åè®®|Private|cloudflare|CN|cn)).*$"

CN: &CN "^(?=.*(CN)).*$"
# å…¶ä»–
Other: &Other "^(?!.*(ğŸ‡­ğŸ‡°|HK|Hong Kong|æ¸¯|ğŸ‡¯ğŸ‡µ|JP|Japan|æ—¥æœ¬|ğŸ‡ºğŸ‡¸|US|United States|ç¾å›½|ğŸ‡¨ğŸ‡³|TW|Taiwan|å°|æ–°åŒ—|å½°åŒ–|ğŸ‡¸ğŸ‡¬|SG|Singapore|æ–°åŠ å¡|ç‹®åŸ|ä¸“çº¿|IPLC|IEPL|é«˜é€Ÿ|ä¸‰ç½‘|ç”µä¿¡|ç§»åŠ¨|è”é€š|ä¸­è½¬|ä¼˜åŒ–|å®¶å®½|åŸç”Ÿ|è½åœ°|æ–°åè®®|Private|cloudflare|CN|cn)).*$"

#é”šç‚¹ç»„-ä»¥ä¸‹é…ç½®æ›´æ”¹ä¼šå½±å“æ˜ å°„çš„æ‰€æœ‰ä»£ç†ç»„

#é”šç‚¹-æ‹‰å–è®¢é˜…é“¾æ¥

p: &p
  type: http
  interval: 3600
  proxy: CNExports
  health-check:
    enable: true
    url: https://www.gstatic.com/generate_204
    interval: 300
  header:
      User-Agent:
        - "clash-verge/v2.2.3"

U-dns: &U-dns
  type: smart
  uselightgbm: true
#  collectdata: true
  strategy: sticky-sessions
  udp: true
  proxies:
    - Private
    - CNRoam
    - CNDirect
    - Dedicated
    - Transit
    - Country
#åœ°åŒºæ™ºèƒ½é€‰æ‹©
U-smart: &U-smart
  type: smart
  uselightgbm: true
#  collectdata: true
  strategy: sticky-sessions
  udp: true
  include-all-providers: true

# ä»£ç†è§„åˆ™é”šç‚¹

U-over: &U-over
  type: smart
  policy-priority: "(Dedicated|Transit):1.5"
  uselightgbm: true
#  collectdata: true
  strategy: sticky-sessions
  udp: true
  proxies:
    - Dedicated
    - Transit
    - Country

U-overCn: &U-overCn
  type: smart
  policy-priority: "CNRoam:1.5"
  uselightgbm: true
#  collectdata: true
  strategy: sticky-sessions
  udp: true
  proxies:
    - CNRoam
    - CNDirect

U-smartGlobal: &U-smartGlobal
  type: smart
  policy-priority: "(æ—¥æœ¬|å°æ¹¾|æ–°åŠ å¡):1.5"
  uselightgbm: true
#  collectdata: true
  strategy: sticky-sessions
  udp: true
  proxies:
    - æ—¥æœ¬
    - æ–°åŠ å¡
    - ç¾å›½
    - å°æ¹¾
    - é¦™æ¸¯
    - å…¶ä»–

#è®¢é˜…é“¾æ¥åˆ†åŒº
proxy-providers:
  æµ®ç”Ÿè‹¥æ¢¦:
    <<: *p
    url: "https://c.killove.cn/hs"
    path: ./Subscribe/æµ®ç”Ÿè‹¥æ¢¦

proxies:
  - name: CNDirect
    type: direct
    udp: true

  - name: DNS_Hijack
    type: dns

# ä»£ç†ç»„åˆ†åŒº
proxy-groups:
  - name: DNS
    <<: *U-dns

  - name: BiliBili
    <<: *U-over

  - name: TikTok
    <<: *U-over

  - name: YouTube
    <<: *U-over

  - name: Google
    <<: *U-over

  - name: Steam
    <<: *U-over

  - name: Microsoft
    <<: *U-over

  - name: Netflix
    <<: *U-over

  - name: Apple
    <<: *U-over

  - name: Telegram
    <<: *U-over

  - name: GitHub
    <<: *U-over

  - name: OpenAI
    <<: *U-over

  - name: Twitter(X)
    <<: *U-over

  - name: Customized
    <<: *U-over

  - name: CNExports
    <<: *U-overCn

  #DNSç‹¬ç«‹åˆ†ç»„

  - name: Private
    <<: *U-smart
    filter: *Kers

  # è‡ªåŠ¨é€‰æ‹©ç­–ç•¥
  - name: Dedicated
    <<: *U-smart
    filter: *Dedicated

  - name: Transit
    <<: *U-smart
    filter: *Transit

  - name: é¦™æ¸¯
    <<: *U-smart
    filter: *Hong

  - name: æ—¥æœ¬
    <<: *U-smart
    filter: *Japan

  - name: ç¾å›½
    <<: *U-smart
    filter: *United

  - name: å°æ¹¾
    <<: *U-smart
    filter: *Taiwan

  - name: æ–°åŠ å¡
    <<: *U-smart
    filter: *Lion

  - name: Country
    <<: *U-smartGlobal
    filter: *Other

  - name: CNRoam
    url: http://connect.rom.miui.com/generate_204
    <<: *U-smart
    filter: *CN

  - name: å…¶ä»–
    <<: *U-smart
    filter: *Other

#è§„åˆ™
rule-anchor:
  Local: &Local
    {type: file, behavior: classical, format: text}
  Classical: &Classical
    {type: http, behavior: classical, format: text, interval: 86400}
  IPCIDR: &IPCIDR
    {type: http, behavior: ipcidr, format: mrs, interval: 86400}
  Domain: &Domain
    {type: http, behavior: domain, format: mrs, interval: 86400}

rule-providers:

  FS: # ç”¨äºfake IPè¿‡æ»¤
    <<: *Classical
    url: "https://raw.githubusercontent.com/kers701/rule/main/rules/FS"
    path: ./rules/FS

  DNS: 
    <<: *Classical
    url: "https://raw.githubusercontent.com/kers701/rule/main/rules/dns"
    path: ./rules/dns

  DNS_IP: 
    <<: *Classical
    url: "https://raw.githubusercontent.com/kers701/rule/main/rules/dnsip"
    path: ./rules/dnsip

  YM: #è‡ªå®šä¹‰é¿å…æŸäº›éœ€è¦ç›´è¿çš„é“¾æ¥è¢«ä»£ç†æˆ–æ‹¦æˆª
    <<: *Classical
    url: "https://raw.githubusercontent.com/kers701/rule/main/rules/YM"
    path: ./rules/YM

  YM_IP: 
    <<: *Classical
    url: "https://raw.githubusercontent.com/kers701/rule/main/rules/YMip"
    path: ./rules/YMip

  Customized:
    <<: *Classical
    url: "https://raw.githubusercontent.com/kers701/rule/main/rules/C"
    path: ./rules/C

  Customized_IP:
    <<: *Classical
    url: "https://raw.githubusercontent.com/kers701/rule/main/rules/Cip"
    path: ./rules/Cip

  WebRTC_ç«¯/åŸŸ:
    <<: *Classical
    path: ./rules/rct.list
    url: "https://cdn.jsdelivr.net/gh/GitMetaio/Surfing@rm/Home/rules/WebRTC.list"

  TikTok_åŸŸ:
    <<: *Domain
    path: ./rules/TikTok.mrs
    url: "https://cdn.jsdelivr.net/gh/GitMetaio/rule@master/rule/Clash/TikTok/TikTok_OCD_Domain.mrs"

  BiliBili_åŸŸ:
    <<: *Domain
    path: ./rules/BiliBili.mrs
    url: "https://cdn.jsdelivr.net/gh/GitMetaio/rule@master/rule/Clash/BiliBili/BiliBili_OCD_Domain.mrs"
  BiliBili_IP:
    <<: *IPCIDR
    path: ./rules/BiliBili_IP.mrs
    url: "https://cdn.jsdelivr.net/gh/GitMetaio/rule@master/rule/Clash/BiliBili/BiliBili_OCD_IP.mrs"

  CN_IP:
    <<: *IPCIDR
    path : ./rules/cnp.mrs
    url: "https://cdn.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@meta/geo/geoip/cn.mrs"
  CN_åŸŸ:
    <<: *Domain
    path : ./rules/cny.mrs
    url: "https://cdn.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@meta/geo/geosite/cn.mrs"

  No-ads-all_åŸŸ:
    <<: *Domain
    path : ./rules/adsy.mrs
    url: "https://anti-ad.net/mihomo.mrs"

  Steam_åŸŸ:
    <<: *Domain
    path : ./rules/steamy.mrs
    url: "https://cdn.jsdelivr.net/gh/GitMetaio/rule@master/rule/Clash/Steam/Steam_OCD_Domain.mrs"

  Telegram_åŸŸ:
    <<: *Domain
    path : ./rules/telegramy.mrs
    url: "https://cdn.jsdelivr.net/gh/GitMetaio/rule@master/rule/Clash/Telegram/Telegram_OCD_Domain.mrs"
  Telegram_IP:
    <<: *IPCIDR
    path : ./rules/telegramp.mrs
    url: "https://cdn.jsdelivr.net/gh/GitMetaio/rule@master/rule/Clash/Telegram/Telegram_OCD_IP.mrs"

  YouTube_åŸŸ:
    <<: *Domain
    path : ./rules/youtubey.mrs
    url: "https://cdn.jsdelivr.net/gh/GitMetaio/rule@master/rule/Clash/YouTube/YouTube_OCD_Domain.mrs"
  YouTube_IP:
    <<: *IPCIDR
    path : ./rules/youtubep.mrs
    url: "https://cdn.jsdelivr.net/gh/GitMetaio/rule@master/rule/Clash/YouTube/YouTube_OCD_IP.mrs"

  Google_åŸŸ:
    <<: *Domain
    path : ./rules/googley.mrs
    url: "https://cdn.jsdelivr.net/gh/GitMetaio/rule@master/rule/Clash/Google/Google_OCD_Domain.mrs"
  Google_IP:
    <<: *IPCIDR
    path : ./rules/googlep.mrs
    url: "https://cdn.jsdelivr.net/gh/GitMetaio/rule@master/rule/Clash/Google/Google_OCD_IP.mrs"

  GoogleFCM_åŸŸ:
    <<: *Domain
    path : ./rules/fcmy.mrs
    url: "https://cdn.jsdelivr.net/gh/GitMetaio/rule@master/rule/Clash/GoogleFCM/GoogleFCM_OCD_Domain.mrs"
  GoogleFCM_IP:
    <<: *IPCIDR
    path : ./rules/fcmp.mrs
    url: "https://cdn.jsdelivr.net/gh/GitMetaio/rule@master/rule/Clash/GoogleFCM/GoogleFCM_OCD_IP.mrs"

  Microsoft_åŸŸ:
    <<: *Domain
    path : ./rules/microsofty.mrs
    url: "https://cdn.jsdelivr.net/gh/GitMetaio/rule@master/rule/Clash/Microsoft/Microsoft_OCD_Domain.mrs"

  Apple_åŸŸ:
    <<: *Domain
    path : ./rules/appley.mrs
    url: "https://cdn.jsdelivr.net/gh/GitMetaio/rule@master/rule/Clash/Apple/Apple_OCD_Domain.mrs"
  Apple_IP:
    <<: *IPCIDR
    path : ./rules/appleip.mrs
    url: "https://cdn.jsdelivr.net/gh/GitMetaio/rule@master/rule/Clash/Apple/Apple_OCD_IP.mrs"

  OpenAI_åŸŸ:
    <<: *Domain
    path : ./rules/openaiy.mrs
    url: "https://cdn.jsdelivr.net/gh/GitMetaio/rule@master/rule/Clash/OpenAI/OpenAI_OCD_Domain.mrs"
  OpenAI_IP:
    <<: *IPCIDR
    path : ./rules/openaip.mrs
    url: "https://cdn.jsdelivr.net/gh/GitMetaio/rule@master/rule/Clash/OpenAI/OpenAI_OCD_IP.mrs"

  Netflix_åŸŸ:
    <<: *Domain
    path : ./rules/netflixy.mrs
    url: "https://cdn.jsdelivr.net/gh/GitMetaio/rule@master/rule/Clash/Netflix/Netflix_OCD_Domain.mrs"
  Netflix_IP:
    <<: *IPCIDR
    path : ./rules/netflixp.mrs
    url: "https://cdn.jsdelivr.net/gh/GitMetaio/rule@master/rule/Clash/Netflix/Netflix_OCD_IP.mrs"

  GitHub_åŸŸ:
    <<: *Domain
    path : ./rules/githuby.mrs
    url: "https://cdn.jsdelivr.net/gh/GitMetaio/rule@master/rule/Clash/GitHub/GitHub_OCD_Domain.mrs"

  Twitter_åŸŸ:
    <<: *Domain
    path : ./rules/twittery.mrs
    url: "https://cdn.jsdelivr.net/gh/GitMetaio/rule@master/rule/Clash/Twitter/Twitter_OCD_Domain.mrs"
  Twitter_IP:
    <<: *IPCIDR
    path : ./rules/twitterp.mrs
    url: "https://cdn.jsdelivr.net/gh/GitMetaio/rule@master/rule/Clash/Twitter/Twitter_OCD_IP.mrs"
  
  private_åŸŸ:
    <<: *Domain
    path : ./rules/privatey.mrs
    url: "https://cdn.jsdelivr.net/gh/GitMetaio/rule@master/rule/Clash/Lan/Lan_OCD_Domain.mrs"
  private_IP:
    <<: *IPCIDR
    path : ./rules/privatep.mrs
    url: "https://cdn.jsdelivr.net/gh/GitMetaio/rule@master/rule/Clash/Lan/Lan_OCD_IP.mrs"

rules:
  - OR,((DST-PORT,53),(DST-PORT,853)),DNS_Hijack

  - OR,((RULE-SET,DNS),(RULE-SET,DNS_IP,no-resolve)),DNS

  # ä¼˜å…ˆç›´è¿ç½‘ç«™(è‡ªå®šä¹‰é¿å…æŸäº›éœ€è¦ç›´è¿çš„é“¾æ¥è¢«ä»£ç†æˆ–æ‹¦æˆª)
  - OR,((RULE-SET,YM),(RULE-SET,YM_IP,no-resolve)),CNExports

  # ä¼˜å…ˆä»£ç†ç½‘ç«™(è‡ªå®šä¹‰é¿å…æŸäº›éœ€è¦ä»£ç†çš„é“¾æ¥è¢«æ‹¦æˆª)
  - OR,((RULE-SET,Customized),(RULE-SET,Customized_IP,no-resolve)),Customized

  # å¹¿å‘Šæ‹¦æˆªç”¨äºå¤„ç†DNSæœªæ‹¦æˆªçš„å¹¿å‘Š
  - OR,((RULE-SET,No-ads-all_åŸŸ),(RULE-SET,WebRTC_ç«¯/åŸŸ)),REJECT-DROP

  # ç»„åˆè§„åˆ™

  - OR,((PROCESS-PATH,tv.danmaku.bili),(RULE-SET,BiliBili_åŸŸ),(RULE-SET,BiliBili_IP,no-resolve)),BiliBili

  - OR,((RULE-SET,YouTube_åŸŸ),(RULE-SET,YouTube_IP,no-resolve)),YouTube

  - OR,((RULE-SET,Netflix_åŸŸ),(RULE-SET,Netflix_IP,no-resolve)),Netflix

  - OR,((RULE-SET,Telegram_åŸŸ),(RULE-SET,Telegram_IP,no-resolve)),Telegram

  - OR,((RULE-SET,Twitter_åŸŸ),(RULE-SET,Twitter_IP,no-resolve)),Twitter(X)

  - OR,((RULE-SET,Apple_åŸŸ),(RULE-SET,Apple_IP,no-resolve)),Apple

  - OR,((RULE-SET,OpenAI_åŸŸ),(RULE-SET,OpenAI_IP,no-resolve)),OpenAI

  - OR,((RULE-SET,Google_åŸŸ),(DOMAIN-KEYWORD,mtalk.google),(RULE-SET,GoogleFCM_åŸŸ),(RULE-SET,Google_IP,no-resolve),(RULE-SET,GoogleFCM_IP,no-resolve)),Google
  
  #ç›´è¿åŸŸååŒ¹é…

  - OR,((RULE-SET,CN_åŸŸ),(RULE-SET,CN_IP),(RULE-SET,private_åŸŸ),(RULE-SET,private_IP,no-resolve)),CNExports

  # å•ä¸€è§„åˆ™

  - RULE-SET,GitHub_åŸŸ,GitHub
  - RULE-SET,Microsoft_åŸŸ,Microsoft
  - RULE-SET,Steam_åŸŸ,Steam
  - RULE-SET,TikTok_åŸŸ,TikTok

  #å…œåº•
  - MATCH,Customized